# **GeekNotes** — это веб-приложение, разработанное на платформе Spring Boot, которое предоставляет функционал для создания, управления и просмотра постов, а также взаимодействия пользователей через комментарии. Приложение включает в себя систему аутентификации и авторизации, а также поддерживает ролевое управление доступом.
## Основные функции
### 1. **Пользователи**
- **Регистрация и вход**: Пользователи могут зарегистрироваться, войти в систему и редактировать свои профили.
- **Аватары**: Пользователи могут загружать аватары, которые будут отображаться в профиле.
- **Роли**: Поддерживаются роли "USER" (обычный пользователь) и "ADMIN" (администратор).
### 2. **Посты**
- **Создание и просмотр**: Пользователи могут просматривать посты, а администраторы могут создавать и публиковать их.
- **Редактирование и удаление**: Администраторы могут редактировать и удалять посты.
- **Комментарии**: Пользователи могут оставлять комментарии к постам.
### 3. **Предварительные посты**
- **Создание и управление**: Администраторы могут создавать предварительные посты, редактировать их и публиковать.
- **Удаление**: Администраторы могут удалять предварительные посты.
### 4. **Теги**
- **Привязка к постам**: К каждому посту привязаны один или несколько тегов.
---
## Технологии и инструменты
- **Фреймворк**: Spring Boot.
- **Безопасность**: Spring Security для аутентификации и авторизации.
- **Хранение данных**: JPA (Hibernate) для работы с базой данных.
- **Хеширование паролей**: BCrypt для безопасного хранения паролей.
- **Изображения**: Изображения постов и аватары пользователей хранятся в формате BLOB и отображаются в Base64.

---

# Контроллеры приложения GeekNotes
## `PostController` — это контроллер, отвечающий за управление постами, предварительными постами и комментариями в приложении GeekNotes. Он обрабатывает HTTP-запросы, связанные с созданием, чтением, обновлением и удалением данных.
### Методы для работы с постами
- **redirect (GET /)** — Перенаправляет пользователя на страницу со списком постов (`/posts`).
- **posts (GET /posts)** — Отображает список всех постов. Поддерживает поиск по заголовку поста через параметр `query`.
- **post (GET /posts/{postUrl})** — Отображает конкретный пост по его уникальному URL.
- **updatePost (GET /posts/{postUrl}/update)** — Форма для редактирования поста.
- **updatePost (POST /posts/{postUrl}/update)** — Обновляет данные поста.
- **deletePost (POST /posts/{postUrl}/delete)** — Удаляет пост по его уникальному URL.
---
### Методы для работы с предварительными постами
- **prePosts (GET /posts/pre-posts)** — Отображает список всех предварительных постов.
- **prePost (GET /posts/pre-posts/{prePostUrl})** — Отображает конкретный предварительный пост по его уникальному URL.
- **updatePrePost (GET /posts/pre-posts/{prePostUrl}/update)** — Форма для редактирования предварительного поста.
- **updatePrePost (POST /posts/pre-posts/{prePostUrl}/update)** — Обновляет данные предварительного поста.
- **createPrePost (GET /posts/pre-posts/create-pre-post)** — Форма для создания нового предварительного поста.
- **createPrePost (POST /posts/pre-posts/create-pre-post)** — Создает новый предварительный пост с загрузкой изображения и тегов.
- **deletePrePost (POST /posts/pre-posts/{prePostUrl}/delete)** — Удаляет предварительный пост по его уникальному URL.
- **publishPrePost (POST /posts/pre-posts/{prePostUrl}/publish)** — Публикует предварительный пост, преобразуя его в пост и удаляя из списка предварительных постов.
---
### Методы для работы с комментариями
- **addComment (POST /posts/{postUrl}/comment)** — Добавляет новый комментарий к посту по его уникальному URL.
---
### Транзакционные методы
Следующие методы помечены аннотацией `@Transactional`, чтобы обеспечить атомарность операций:
- **updatePost (POST /posts/{postUrl}/update)**
- **updatePrePost (POST /posts/pre-posts/{prePostUrl}/update)**
- **addComment (POST /posts/{postUrl}/comment)**
- **deletePrePost (POST /posts/pre-posts/{prePostUrl}/delete)**
- **deletePost (POST /posts/{postUrl}/delete)**
- **createPrePost (POST /posts/pre-posts/create-pre-post)**
- **publishPrePost (POST /posts/pre-posts/{prePostUrl}/publish)**

### Зависимости
Контроллер использует следующие репозитории:
- `UserRepo` — для работы с пользователями.
- `PostRepo` — для работы с постами.
- `PrePostRepo` — для работы с предварительными постами.
- `TagRepo` — для работы с тегами.
- `CommentRepo` — для работы с комментариями.

---

## `UserController` — это контроллер, отвечающий за управление пользователями в приложении GeekNotes. Он обрабатывает HTTP-запросы, связанные с регистрацией, аутентификацией, обновлением профиля и другими действиями, связанными с пользователями.
### Методы для работы с пользователями
- **signUp (GET /sign-up)** — Отображает форму для регистрации нового пользователя.
- **signUp (POST /sign-up)** — Обрабатывает регистрацию нового пользователя. Проверяет уникальность логина и совпадение паролей. Если всё в порядке, сохраняет пользователя в базе данных.
- **login (GET /login)** — Отображает форму для входа пользователя в систему.
- **user (GET /users/{userLogin})** — Отображает профиль пользователя по его логину.
- **updateUser (GET /users/{userLogin}/update)** — Отображает форму для редактирования профиля пользователя. Доступно только для пользователя с соответствующим логином.
- **updateUser (POST /users/{userLogin}/update)** — Обрабатывает обновление данных пользователя. Если загружено новое изображение, оно будет обработано и сохранено.
---
### Транзакционные методы
Следующие методы помечены аннотацией `@Transactional`, чтобы обеспечить атомарность операций:
- **signUp (POST /sign-up)**
---
### Зависимости
Контроллер использует следующие компоненты:
- `UserRepo` — для работы с пользователями в базе данных.
- `PasswordEncoder` — для хеширования паролей.

---

# Модели приложения GeekNotes
## 1. **Comment (Комментарий)**
### Описание
Модель `Comment` представляет комментарий, оставленный пользователем к посту.
### Поля
- **commentId (Long)** — Уникальный идентификатор комментария.
- **post (Post)** — Связь с постом, к которому относится комментарий (Many-to-One).
- **user (User)** — Связь с пользователем, который оставил комментарий (Many-to-One).
- **content (String)** — Текст комментария (хранится как `TEXT`).
### Конструкторы
- **Пустой конструктор** — Используется для создания нового объекта.
- **Конструктор с параметрами** — Принимает пост, пользователя и текст комментария.
---
## 2. **Post (Пост)**
### Описание
Модель `Post` представляет пост в блоге. Пост может содержать изображение, текст, теги и комментарии.
### Поля
- **postId (Long)** — Уникальный идентификатор поста.
- **postTitle (String)** — Заголовок поста.
- **postImg (byte[])** — Изображение поста (хранится как BLOB).
- **postDescription (String)** — Краткое описание поста.
- **postText (String)** — Текст поста (хранится как `TEXT`).
- **postTags (Set<Tag>)** — Множество тегов, связанных с постом (Many-to-Many).
- **postUrl (String)** — Уникальный URL поста.
- **postComments (List<Comment>)** — Список комментариев к посту (One-to-Many).
### Методы
- **hasImage()** — Проверяет, содержит ли пост изображение.
- **getPostImg()** — Возвращает изображение в формате Base64, если оно есть.
### Конструкторы
- **Пустой конструктор** — Используется для создания нового объекта.
- **Конструктор с параметрами** — Принимает заголовок, изображение, описание, текст и URL поста.
---
## 3. **PrePost (Предварительный пост)**
### Описание
Модель `PrePost` представляет предварительный пост, который ещё не опубликован. После редактирования и публикации он преобразуется в пост (`Post`).
### Поля
- **prePostId (Long)** — Уникальный идентификатор предварительного поста.
- **prePostTitle (String)** — Заголовок предварительного поста.
- **prePostImg (byte[])** — Изображение предварительного поста (хранится как BLOB).
- **prePostDescription (String)** — Краткое описание предварительного поста.
- **prePostText (String)** — Текст предварительного поста (хранится как `TEXT`).
- **prePostTags (String)** — Теги предварительного поста (хранится как строка).
- **prePostUrl (String)** — Уникальный URL предварительного поста.
### Методы
- **hasImage()** — Проверяет, содержит ли предварительный пост изображение.
- **getPrePostImgBase64()** — Возвращает изображение в формате Base64, если оно есть.
### Конструкторы
- **Пустой конструктор** — Используется для создания нового объекта.
- **Конструктор с параметрами** — Принимает заголовок, изображение, описание, текст, теги и URL предварительного поста.
---
## 4. **Tag (Тег)**
### Описание
Модель `Tag` представляет тег, который может быть привязан к постам.
### Поля
- **id (int)** — Уникальный идентификатор тега.
- **tagName (String)** — Название тега.
- **posts (List<Post>)** — Список постов, связанных с тегом (Many-to-Many).
---
## 5. **User (Пользователь)**
### Описание
Модель `User` представляет пользователя приложения.
### Поля
- **userId (Long)** — Уникальный идентификатор пользователя.
- **userName (String)** — Имя пользователя.
- **userLogin (String)** — Логин пользователя.
- **userAvatar (byte[])** — Аватар пользователя (хранится как BLOB).
- **userEmail (String)** — Email пользователя.
- **userAbout (String)** — Описание пользователя.
- **userPassword (String)** — Пароль пользователя (хранится в зашифрованном виде).
- **userRole (String)** — Роль пользователя (например, "USER" или "ADMIN").
### Методы
- **hasImage()** — Проверяет, содержит ли пользователь аватар.
- **getUserAvatar()** — Возвращает аватар в формате Base64, если он есть.
### Конструкторы
- **Пустой конструктор** — Используется для создания нового объекта.
- **Конструктор с параметрами** — Принимает имя, логин, email, пароль и роль пользователя.

---

# Репозитории приложения GeekNotes
## 1. **CommentRepo**
### Описание
Репозиторий для работы с комментариями.
### Интерфейс
- **JpaRepository<Comment, Long>** — Базовый интерфейс для работы с сущностью `Comment`.
---
## 2. **PostRepo**
### Описание
Репозиторий для работы с постами.
### Интерфейс
- **JpaRepository<Post, Long>** — Базовый интерфейс для работы с сущностью `Post`.
### Дополнительные методы
- **findByPostUrl(String postUrl)** — Возвращает пост по его уникальному URL.
- **findByPostTitleContainingIgnoreCase(String postTitle)** — Возвращает список постов, содержащих указанную подстроку в заголовке (без учёта регистра).
---
## 3. **PrePostRepo**
### Описание
Репозиторий для работы с предварительными постами.
### Интерфейс
- **JpaRepository<PrePost, Long>** — Базовый интерфейс для работы с сущностью `PrePost`.
### Дополнительные методы
- **findByPrePostUrl(String prePostUrl)** — Возвращает предварительный пост по его уникальному URL.
---
## 4. **TagRepo**
### Описание
Репозиторий для работы с тегами.
### Интерфейс
- **JpaRepository<Tag, Integer>** — Базовый интерфейс для работы с сущностью `Tag`.
### Дополнительные методы
- **findByTagName(String tagName)** — Возвращает тег по его названию.
---
## 5. **UserRepo**
### Описание
Репозиторий для работы с пользователями.
### Интерфейс
- **JpaRepository<User, Long>** — Базовый интерфейс для работы с сущностью `User`.
### Дополнительные методы
- **findByUserLogin(String userLogin)** — Возвращает пользователя по его логину.

Вот документация для класса конфигурации безопасности `WebSecurityConfig` в формате `README.md`, где описаны его компоненты, методы и настройки:

---

# Конфигурация безопасности приложения GeekNotes
## Основные компоненты
### 1. **SecurityFilterChain**
#### Описание
`SecurityFilterChain` определяет правила доступа к различным URL в приложении. Он настраивает, какие запросы доступны всем пользователям, а какие требуют аутентификации или определённых ролей.
#### Настройки
- **Разрешённые URL для всех пользователей**:
    - `/`, `/posts` — Главная страница и список постов.
    - `/login`, `/sign-up` — Страницы входа и регистрации.
    - `/posts/{postUrl}` — Страница конкретного поста.
- **URL, требующие аутентификации**:
    - `/users/{userLogin}/update` — Редактирование профиля пользователя.
    - `/posts/{postUrl}/comment` — Добавление комментария к посту.
    - `/users/{userLogin}` — Просмотр профиля пользователя.
- **URL, требующие роли ADMIN**:
    - `/posts/pre-posts/create-pre-post` — Создание предварительного поста.
    - `/posts/pre-posts` — Список предварительных постов.
    - `/posts/pre-posts/{prePostUrl}` — Просмотр предварительного поста.
    - `/posts/pre-posts/{prePostUrl}/publish` — Публикация предварительного поста.
    - `/posts/pre-posts/{prePostUrl}/delete` — Удаление предварительного поста.
    - `/posts/{postUrl}/delete` — Удаление поста.
    - `/posts/{postUrl}/update` — Редактирование поста.
    - `/posts/pre-posts/{prePostUrl}/update` — Редактирование предварительного поста.
- **Любые другие запросы**:
    - Требуют аутентификации.
#### Настройки формы входа
- **loginPage("/login")** — Используется пользовательская страница входа.
- **defaultSuccessUrl("/", true)** — После успешного входа перенаправляет на главную страницу.
- **failureUrl("/login?error=true")** — В случае ошибки входа перенаправляет на страницу входа с параметром ошибки.
#### Настройки выхода
- **logoutSuccessUrl("/")** — После выхода перенаправляет на главную страницу.
---
### 2. **PasswordEncoder**
#### Описание
`PasswordEncoder` используется для хеширования паролей пользователей.
#### Реализация
- **BCryptPasswordEncoder** — Используется для хеширования паролей с помощью алгоритма BCrypt.
---
### 3. **UserDetailsService**
#### Описание
`UserDetailsService` отвечает за загрузку данных пользователя из базы данных.
#### Реализация
- **userDetailsService()** — Ищет пользователя по логину в базе данных. Если пользователь найден, возвращает объект `UserDetails`. Если пользователь не найден, выбрасывает исключение `UsernameNotFoundException`.